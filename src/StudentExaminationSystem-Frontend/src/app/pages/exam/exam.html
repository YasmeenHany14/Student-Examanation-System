<div class="exam-container h-screen flex flex-col" *ngIf="!isLoading()">
  <!-- Top third: Question indicator and navigation -->
  <div class="question-navigator h-1/3 border-b border-gray-200 p-4">
    <div class="flex flex-col h-full">
      <!-- Progress bar and info -->
      <div class="mb-4">
        <div class="flex justify-between items-center mb-2">
          <h2 class="text-lg font-semibold">
            Take Exam
          </h2>
          <span class="text-sm text-gray-600">
            Question {{ currentQuestionIndex() + 1 }} of {{ totalQuestions() }}
          </span>
        </div>
        <p-progressBar
          [value]="progressPercentage()"
          [showValue]="false"
          styleClass="mb-2">
        </p-progressBar>
        <div class="text-xs text-gray-500">
          Progress: {{ progressPercentage() | number:'1.0-0' }}%
          ({{ answeredQuestions() }}/{{ totalQuestions() }} answered)
        </div>
      </div>

      <!-- Question boxes grid -->
      <div class="flex-1 overflow-auto">
        <div class="grid grid-cols-8 md:grid-cols-10 lg:grid-cols-12 gap-2">
          @for(question of exam()?.questions; track question.id; let i = $index) {
            <button
              type="button"
              class="question-box aspect-square flex items-center justify-center text-sm font-medium rounded transition-all duration-200"
              [class]="getQuestionBoxClass(i)"
              (click)="goToQuestion(i)">
              {{ i + 1 }}
            </button>
          }
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom two thirds: Question content and navigation -->
  <div class="question-content flex-1 flex flex-col">
    <!-- Question card area -->
    <div class="flex-1 p-6 overflow-auto">
      @if(currentQuestion()) {
        <app-question-card
          [question]="currentQuestion()"
          [viewMode]="false"
          [showMetadata]="false"
          [selectedChoiceId]="getSelectedAnswer(currentQuestionIndex())"
          (choiceSelected)="onAnswerSelected($event)">
        </app-question-card>
      }
    </div>

    <!-- Navigation buttons -->
    <div class="navigation-bar border-t border-gray-200 p-4">
      <div class="flex justify-between items-center">
        <p-button
          label="Previous"
          icon="pi pi-chevron-left"
          [disabled]="!canGoPrevious()"
          severity="secondary"
          size="small"
          (onClick)="previousQuestion()">
        </p-button>

        <div class="flex gap-2">
          <p-button
            label="Submit Exam"
            icon="pi pi-check"
            severity="success"
            size="small"
            (onClick)="submitExam()">
          </p-button>
        </div>

        <p-button
          label="Next"
          icon="pi pi-chevron-right"
          iconPos="right"
          [disabled]="!canGoNext()"
          severity="secondary"
          size="small"
          (onClick)="nextQuestion()">
        </p-button>
      </div>
    </div>
  </div>
</div>

<!-- Loading state -->
<div class="loading-container flex items-center justify-center h-screen" *ngIf="isLoading()">
  <div class="text-center">
    <i class="pi pi-spin pi-spinner text-4xl text-blue-500 mb-4"></i>
    <p class="text-lg text-gray-600">Loading exam...</p>
  </div>
</div>

<!-- Toast for notifications -->
<p-toast></p-toast>
